# 正则表达式两种引擎 NFA引擎的匹配原理 匹配优先和忽略优先


两种引擎：

*   NFA, 传统的引擎, 表达式主导
*   DFA, 较新的引擎, 内容主导

两种引擎区别：

例：用'AA(11|22|33)'匹配'AA22'
    
```text
    NFA: 表达式主导，由正则表达式中'AA', 匹配内容中的'AA', 
    接着是表达式的'(11|22|33)', 先用表达式的'11'尝试匹配内容的'22', 并将'(11|22|33)'中'22'和'33'保存起来，当匹配失败时继续尝试匹配'22'和'33'
    此时用'11'匹配'22'失败，于是再用保存的'22'匹配'22', 此时匹配成功，引擎结束.

    DFA: 内容主导，由内容的'AA'，匹配正则表达式的'AA',
    接着用内容的’22‘的第一个'2'匹配表达式的'(11|22|33)', 发现只有表达式的'22'的第一个‘2’能匹配
    再接着用内容'22'的第二个‘2’，匹配表达式‘22’的第二个‘2’，发现也能匹配，于是匹配成功，引擎结束。

    总结：两种引擎结果相同。DFA更快，因为表达式中的内容不会多次尝试匹配。但NFA引擎更值得研究，用的更广。
```

NFA引擎的匹配原理：

```text
例：匹配优先和忽略优先: 用‘AB？C’匹配‘AC'
    首先由表达式的‘A’匹配内容的‘A’
    接着是表达式'B?'，由于‘？’是匹配优先量词(‘？？’是忽略优先量词)，所以优先尝试用‘B存在’匹配‘C’，并将‘B不存在'保存进来, 当匹配失败时继续尝试‘B不存在’
    此时匹配失败，回溯到‘B不存在’，B不存在，则用表达式的‘C’匹配内容的‘C’，匹配成功。
例：匹配优先和忽略优先: 用'.*BC'匹配'ABC'
    首先是‘.*'，由于‘＊’是匹配优先量词（‘＊？’是忽略优先量词），所以用‘.*'优先匹配所有字符'ABC', 
        并将'.*'匹配0个字符的情况保存起来，
        '.*'匹配1个字符'A'的情况保存起来，
        '.*'匹配2个字符'AB'的情况保存起来，
    然后用表达式的’BC‘匹配内容的空字符，发现无法匹配，于是回溯一步，到'.*'匹配2个字符'AB'的情况，
    此时用表达式的'BC'匹配内容的‘C’,还是无法匹配，于是再回流一步，到'.*'匹配1个字符'A'的情况，
    此时用表达式的‘BC'匹配内容的'BC', 匹配成功.
```